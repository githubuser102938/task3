!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?t(require("jquery")):t(jQuery)}((function(t){"use strict";function i(t){return"number"==typeof t}function e(t,i){var e=[];return"number"==typeof i&&e.push(i),e.slice.apply(t,e)}function h(t,i){var h=e(arguments,2);return function(){return t.apply(i,h.concat(e(arguments)))}}function a(i,e){this.element=i,this.$element=t(i),this.defaults=t.extend({},a.DEFAULTS,t.isPlainObject(e)?e:{}),this.$original=l,this.ready=g,this.built=g,this.cropped=g,this.rotated=g,this.disabled=g,this.replaced=g,this.init()}var s,r=t(window),n=t(document),o=window.location,d=!0,g=!1,l=null,p="undefined",c="directive",m=".cropper",f=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,u=/^(x|y|width|height)$/,w=/^(naturalWidth|naturalHeight|width|height|aspectRatio|ratio|rotate)$/,v="cropper-modal",x="cropper-hidden",b="cropper-invisible",y="cropper-crop",$="cropper-disabled",D="mousedown touchstart",W="mousemove touchmove",H="mouseup mouseleave touchend touchleave touchcancel",C="wheel mousewheel DOMMouseScroll",k="resize"+m,R="dblclick",z="build"+m,L="built"+m,Y="dragstart"+m,X="dragmove"+m,M="dragend"+m,T=Math.sqrt,I=Math.min,E=Math.max,_=Math.abs,P=Math.sin,O=Math.cos,U=parseFloat;a.prototype={constructor:a,support:{canvas:t.isFunction(t("<canvas>")[0].getContext)},init:function(){var i=this.defaults;t.each(i,(function(t,e){switch(t){case"aspectRatio":i[t]=_(U(e))||NaN;break;case"autoCropArea":i[t]=_(U(e))||.8;break;case"minWidth":case"minHeight":i[t]=_(U(e))||0;break;case"maxWidth":case"maxHeight":i[t]=_(U(e))||1/0}})),this.image={rotate:0},this.load()},load:function(){var i,e,h=this,a=this.$element,s=this.element,r=this.image,n="";a.is("img")?e=a.prop("src"):a.is("canvas")&&this.support.canvas&&(e=s.toDataURL()),e&&(this.replaced&&(r.rotate=0),this.defaults.checkImageOrigin&&(a.prop("crossOrigin")||this.isCrossOriginURL(e))&&(n=" crossOrigin"),this.$clone=i=t("<img"+n+' src="'+e+'">'),i.one("load",(function(){r.naturalWidth=this.naturalWidth||i.width(),r.naturalHeight=this.naturalHeight||i.height(),r.aspectRatio=r.naturalWidth/r.naturalHeight,h.url=e,h.ready=d,h.build()})),i.addClass(b).prependTo("body"))},isCrossOriginURL:function(t){return!(t=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i))||t[1]===o.protocol&&t[2]===o.hostname&&t[3]===o.port?g:d},build:function(){var i,e=this.$element,h=this.defaults;this.ready&&(this.built&&this.unbuild(),e.one(z,h.build),i=t.Event(z),e.trigger(i),i.isDefaultPrevented()||(this.$cropper=i=t(a.TEMPLATE),e.addClass(x),this.$clone.removeClass(b).prependTo(i),this.rotated||(this.$original=this.$clone.clone(),this.$original.addClass(x).prependTo(this.$cropper),this.originalImage=t.extend({},this.image)),this.$container=e.parent(),this.$container.append(i),this.$canvas=i.find(".cropper-canvas"),this.$dragger=i.find(".cropper-dragger"),this.$viewer=i.find(".cropper-viewer"),h.autoCrop?this.cropped=d:this.$dragger.addClass(x),h.dragCrop&&this.setDragMode("crop"),h.modal&&this.$canvas.addClass(v),h.dashed||this.$dragger.find(".cropper-dashed").addClass(x),h.movable||this.$dragger.find(".cropper-face").data(c,"move"),h.resizable||this.$dragger.find(".cropper-line, .cropper-point").addClass(x),this.addListeners(),this.initPreview(),this.built=d,this.update(),this.replaced=g,e.one(L,h.built),e.trigger(L)))},unbuild:function(){this.built&&(this.built=g,this.removeListeners(),this.$preview.empty(),this.$preview=l,this.$dragger=l,this.$canvas=l,this.$container=l,this.$cropper.remove(),this.$cropper=l)},update:function(t){this.initContainer(),this.initCropper(),this.initImage(),this.initDragger(),t?(this.setData(t,d),this.setDragMode("crop")):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing),this.resizing=setTimeout(t.proxy(this.update,this,this.getData()),200)},preview:function(){var i=this.image,e=this.dragger,h=i.width,a=i.height,s=e.left-i.left,r=e.top-i.top;this.$viewer.find("img").css({width:h,height:a,marginLeft:-s,marginTop:-r}),this.$preview.each((function(){var i=t(this),n=i.width()/e.width;i.find("img").css({width:h*n,height:a*n,marginLeft:-s*n,marginTop:-r*n})}))},addListeners:function(){var i=this.defaults;this.$element.on(Y,i.dragstart).on(X,i.dragmove).on(M,i.dragend),this.$cropper.on(D,t.proxy(this.dragstart,this)).on(R,t.proxy(this.dblclick,this)),i.zoomable&&this.$cropper.on(C,t.proxy(this.wheel,this)),i.multiple?this.$cropper.on(W,t.proxy(this.dragmove,this)).on(H,t.proxy(this.dragend,this)):n.on(W,this._dragmove=h(this.dragmove,this)).on(H,this._dragend=h(this.dragend,this)),r.on(k,this._resize=h(this.resize,this))},removeListeners:function(){var t=this.defaults;this.$element.off(Y,t.dragstart).off(X,t.dragmove).off(M,t.dragend),this.$cropper.off(D,this.dragstart).off(R,this.dblclick),t.zoomable&&this.$cropper.off(C,this.wheel),t.multiple?this.$cropper.off(W,this.dragmove).off(H,this.dragend):n.off(W,this._dragmove).off(H,this._dragend),r.off(k,this._resize)},initPreview:function(){var i='<img src="'+this.url+'">';this.$preview=t(this.defaults.preview),this.$viewer.html(i),this.$preview.html(i).find("img").css("cssText","min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;")},initContainer:function(){var t=this.$container;t!==l&&(this.container={width:E(t.width(),300),height:E(t.height(),150)})},initCropper:function(){var t,i=this.container,e=this.image;0<=e.naturalWidth*i.height/e.naturalHeight-i.width?(t={width:i.width,height:i.width/e.aspectRatio,left:0}).top=(i.height-t.height)/2:(t={width:i.height*e.aspectRatio,height:i.height,top:0}).left=(i.width-t.width)/2,this.$cropper&&this.$cropper.css({width:t.width,height:t.height,left:t.left,top:t.top}),this.cropper=t},initImage:function(){var i=this.image,e=this.cropper,h={_width:e.width,_height:e.height,width:e.width,height:e.height,left:0,top:0,ratio:e.width/i.naturalWidth};this.defaultImage=t.extend({},i,h),i._width!==e.width||i._height!==e.height?t.extend(i,h):(i=t.extend({},h,i),this.replaced&&(i.ratio=h.ratio)),this.image=i,this.renderImage()},renderImage:function(t){var i=this.image;"zoom"===t&&(i.left-=(i.width-i.oldWidth)/2,i.top-=(i.height-i.oldHeight)/2),i.left=I(E(i.left,i._width-i.width),0),i.top=I(E(i.top,i._height-i.height),0),this.$clone.css({width:i.width,height:i.height,marginLeft:i.left,marginTop:i.top}),t&&(this.defaults.done(this.getData()),this.preview())},initDragger:function(){var i=this.defaults,e=this.cropper,h=i.aspectRatio||this.image.aspectRatio,a=this.image.ratio,s=0<=e.height*h-e.width?{height:e.width/h,width:e.width,left:0,top:(e.height-e.width/h)/2,maxWidth:e.width,maxHeight:e.width/h}:{height:e.height,width:e.height*h,left:(e.width-e.height*h)/2,top:0,maxWidth:e.height*h,maxHeight:e.height};s.minWidth=0,s.minHeight=0,i.aspectRatio?(isFinite(i.maxWidth)?(s.maxWidth=I(s.maxWidth,i.maxWidth*a),s.maxHeight=s.maxWidth/h):isFinite(i.maxHeight)&&(s.maxHeight=I(s.maxHeight,i.maxHeight*a),s.maxWidth=s.maxHeight*h),0<i.minWidth?(s.minWidth=E(0,i.minWidth*a),s.minHeight=s.minWidth/h):0<i.minHeight&&(s.minHeight=E(0,i.minHeight*a),s.minWidth=s.minHeight*h)):(s.maxWidth=I(s.maxWidth,i.maxWidth*a),s.maxHeight=I(s.maxHeight,i.maxHeight*a),s.minWidth=E(0,i.minWidth*a),s.minHeight=E(0,i.minHeight*a)),s.minWidth=I(s.maxWidth,s.minWidth),s.minHeight=I(s.maxHeight,s.minHeight),s.height*=i.autoCropArea,s.width*=i.autoCropArea,s.left=(e.width-s.width)/2,s.top=(e.height-s.height)/2,s.oldLeft=s.left,s.oldTop=s.top,this.defaultDragger=s,this.dragger=t.extend({},s)},renderDragger:function(){var t=this.dragger,i=this.cropper;t.width>t.maxWidth?(t.width=t.maxWidth,t.left=t.oldLeft):t.width<t.minWidth&&(t.width=t.minWidth,t.left=t.oldLeft),t.height>t.maxHeight?(t.height=t.maxHeight,t.top=t.oldTop):t.height<t.minHeight&&(t.height=t.minHeight,t.top=t.oldTop),t.left=I(E(t.left,0),i.width-t.width),t.top=I(E(t.top,0),i.height-t.height),t.oldLeft=t.left,t.oldTop=t.top,this.dragger=t,this.disabled||this.defaults.done(this.getData()),this.$dragger.css({width:t.width,height:t.height,left:t.left,top:t.top}),this.preview()},reset:function(i){this.cropped&&(i&&(this.defaults.data={}),this.image=t.extend({},this.defaultImage),this.renderImage(),this.dragger=t.extend({},this.defaultDragger),this.setData(this.defaults.data))},clear:function(){this.cropped&&(this.cropped=g,this.setData({x:0,y:0,width:0,height:0}),this.$canvas.removeClass(v),this.$dragger.addClass(x))},destroy:function(){var t=this.$element;this.ready&&(this.unbuild(),t.removeClass(x).removeData("cropper"),this.rotated)&&t.attr("src",this.$original.attr("src"))},replace:function(i,e){var h,a=this,s=this.$element,r=this.element;i&&i!==this.url&&i!==s.attr("src")&&(e||(this.rotated=g,this.replaced=d),s.is("img")?(s.attr("src",i),this.load()):s.is("canvas")&&this.support.canvas&&(h=r.getContext("2d"),t('<img src="'+i+'">').one("load",(function(){r.width=this.width,r.height=this.height,h.clearRect(0,0,r.width,r.height),h.drawImage(this,0,0),a.load()}))))},setData:function(e,h){var a=this.cropper,s=this.dragger,r=this.image,n=this.defaults.aspectRatio;this.built&&typeof e!=p&&(e!==l&&!t.isEmptyObject(e)||(s=t.extend({},this.defaultDragger)),t.isPlainObject(e)&&!t.isEmptyObject(e)&&(h||(this.defaults.data=e),i((e=this.transformData(e)).x)&&e.x<=a.width-r.left&&(s.left=e.x+r.left),i(e.y)&&e.y<=a.height-r.top&&(s.top=e.y+r.top),n?i(e.width)&&e.width<=s.maxWidth&&e.width>=s.minWidth?(s.width=e.width,s.height=s.width/n):i(e.height)&&e.height<=s.maxHeight&&e.height>=s.minHeight&&(s.height=e.height,s.width=s.height*n):(i(e.width)&&e.width<=s.maxWidth&&e.width>=s.minWidth&&(s.width=e.width),i(e.height)&&e.height<=s.maxHeight&&e.height>=s.minHeight&&(s.height=e.height))),this.dragger=s,this.renderDragger())},getData:function(t){var i=this.dragger,e=this.image,h={};return this.built&&(h={x:i.left-e.left,y:i.top-e.top,width:i.width,height:i.height},h=this.transformData(h,d,t)),h},transformData:function(i,e,h){var a=this.image.ratio,s={};return t.each(i,(function(t,i){i=U(i),u.test(t)&&!isNaN(i)&&(s[t]=e?h?Math.round(i/a):i/a:i*a)})),s},setAspectRatio:function(t){var i="auto"===t;t=U(t),(i||!isNaN(t)&&0<t)&&(this.defaults.aspectRatio=i?NaN:t,this.built)&&(this.initDragger(),this.renderDragger())},getImageData:function(){var i={};return this.ready&&t.each(this.image,(function(t,e){w.test(t)&&(i[t]=e)})),i},getDataURL:function(i,e,h){var a,s=t("<canvas>")[0],r=this.getData(),n="";return t.isPlainObject(i)||(h=e,e=i,i={}),i=t.extend({width:r.width,height:r.height},i),this.cropped&&this.support.canvas&&(s.width=i.width,s.height=i.height,a=s.getContext("2d"),"image/jpeg"===e&&(a.fillStyle="#fff",a.fillRect(0,0,i.width,i.height)),a.drawImage(this.$clone[0],r.x,r.y,r.width,r.height,0,0,i.width,i.height),n=s.toDataURL(e,h)),n},setDragMode:function(t){var i=this.$canvas,e=this.defaults,h=g,a=g;if(this.built&&!this.disabled){switch(t){case"crop":e.dragCrop&&(h=d,i.data(c,t));break;case"move":a=d,i.data(c,t);break;default:i.removeData(c)}i.toggleClass(y,h).toggleClass("cropper-move",a)}},enable:function(){this.built&&(this.disabled=g,this.$cropper.removeClass($))},disable:function(){this.built&&(this.disabled=d,this.$cropper.addClass($))},rotate:function(t){var i=this.image;t=U(t)||0,this.built&&0!==t&&!this.disabled&&this.defaults.rotatable&&this.support.canvas&&(this.rotated=d,t=i.rotate=(i.rotate+t)%360,this.replace(this.getRotatedDataURL(t),!0))},getRotatedDataURL:function(i){var e=t("<canvas>")[0],h=e.getContext("2d"),a=i*Math.PI/180,s=(i=(90<(i=_(i)%180)?180-i:i)*Math.PI/180,(r=this.originalImage).naturalWidth),r=r.naturalHeight,n=_(s*O(i)+r*P(i));i=_(s*P(i)+r*O(i));return e.width=n,e.height=i,h.save(),h.translate(n/2,i/2),h.rotate(a),h.drawImage(this.$original[0],-s/2,-r/2,s,r),h.restore(),e.toDataURL()},zoom:function(t){var i,e,h=this.image;t=U(t),this.built&&t&&!this.disabled&&this.defaults.zoomable&&(i=h.width*(1+t),t=h.height*(1+t),10<(e=i/h._width)||(e<1&&(i=h._width,t=h._height),e<=1?this.setDragMode("crop"):this.setDragMode("move"),h.oldWidth=h.width,h.oldHeight=h.height,h.width=i,h.height=t,h.ratio=h.width/h.naturalWidth,this.renderImage("zoom")))},dblclick:function(){this.disabled||(this.$canvas.hasClass(y)?this.setDragMode("move"):this.setDragMode("crop"))},wheel:function(t){var i,e=t.originalEvent;this.disabled||(t.preventDefault(),i=e.deltaY?(i=e.deltaY)%5==0?i/5:i%117.25==0?i/117.25:i/166.66665649414062:e.wheelDelta?-e.wheelDelta/120:e.detail?e.detail/3:0,this.zoom(.1*i))},dragstart:function(i){var e,h,a=i.originalEvent.touches,s=i;if(!this.disabled){if(a){if(1<(h=a.length)){if(!this.defaults.zoomable||2!==h)return;s=a[1],this.startX2=s.pageX,this.startY2=s.pageY,e="zoom"}s=a[0]}e=e||t(s.target).data(c),f.test(e)&&(i.preventDefault(),h=t.Event(Y),this.$element.trigger(h),h.isDefaultPrevented()||(this.directive=e,this.cropping=g,this.startX=s.pageX,this.startY=s.pageY,"crop"===e&&(this.cropping=d,this.$canvas.addClass(v))))}},dragmove:function(i){var e,h=i.originalEvent.touches,a=i;if(!this.disabled){if(h){if(1<(e=h.length)){if(!this.defaults.zoomable||2!==e)return;a=h[1],this.endX2=a.pageX,this.endY2=a.pageY}a=h[0]}this.directive&&(i.preventDefault(),e=t.Event(X),this.$element.trigger(e),e.isDefaultPrevented()||(this.endX=a.pageX,this.endY=a.pageY,this.dragging()))}},dragend:function(i){this.disabled||this.directive&&(i.preventDefault(),i=t.Event(M),this.$element.trigger(i),i.isDefaultPrevented()||(this.cropping&&(this.cropping=g,this.$canvas.toggleClass(v,this.cropped&&this.defaults.modal)),this.directive=""))},dragging:function(){var t,i,e,h,a,s,r=this.directive,n=this.image,o=this.cropper,l=o.width,p=o.height,c=this.dragger,m=c.width,f=c.height,u=c.left,w=c.top,v=u+m,b=w+f,y=d,$=this.defaults,D=$.aspectRatio,W={x:this.endX-this.startX,y:this.endY-this.startY};switch(D&&(W.X=W.y*D,W.Y=W.x/D),r){case"all":u+=W.x,w+=W.y;break;case"e":0<=W.x&&(l<=v||D&&(w<=0||p<=b))?y=g:(m+=W.x,D&&(f=m/D,w-=W.Y/2),m<0&&(r="w",m=0));break;case"n":W.y<=0&&(w<=0||D&&(u<=0||l<=v))?y=g:(f-=W.y,w+=W.y,D&&(m=f*D,u+=W.X/2),f<0&&(r="s",f=0));break;case"w":W.x<=0&&(u<=0||D&&(w<=0||p<=b))?y=g:(m-=W.x,u+=W.x,D&&(f=m/D,w+=W.Y/2),m<0&&(r="e",m=0));break;case"s":0<=W.y&&(p<=b||D&&(u<=0||l<=v))?y=g:(f+=W.y,D&&(m=f*D,u-=W.X/2),f<0&&(r="n",f=0));break;case"ne":if(D){if(W.y<=0&&(w<=0||l<=v)){y=g;break}w+=W.y,m=(f-=W.y)*D}else!(0<=W.x)||v<l?m+=W.x:W.y<=0&&w<=0&&(y=g),(!(W.y<=0)||0<w)&&(f-=W.y,w+=W.y);f<0&&(r="sw",m=f=0);break;case"nw":if(D){if(W.y<=0&&(w<=0||u<=0)){y=g;break}w+=W.y,m=(f-=W.y)*D,u+=W.X}else!(W.x<=0)||0<u?(m-=W.x,u+=W.x):W.y<=0&&w<=0&&(y=g),(!(W.y<=0)||0<w)&&(f-=W.y,w+=W.y);f<0&&(r="se",m=f=0);break;case"sw":if(D){if(W.x<=0&&(u<=0||p<=b)){y=g;break}u+=W.x,f=(m-=W.x)/D}else!(W.x<=0)||0<u?(m-=W.x,u+=W.x):0<=W.y&&p<=b&&(y=g),(!(0<=W.y)||b<p)&&(f+=W.y);m<0&&(r="ne",m=f=0);break;case"se":if(D){if(0<=W.x&&(l<=v||p<=b)){y=g;break}f=(m+=W.x)/D}else!(0<=W.x)||v<l?m+=W.x:0<=W.y&&p<=b&&(y=g),(!(0<=W.y)||b<p)&&(f+=W.y);m<0&&(r="nw",m=f=0);break;case"move":n.left+=W.x,n.top+=W.y,this.renderImage("move"),y=g;break;case"zoom":$.zoomable&&(this.zoom((t=n.width,i=n.height,e=_(this.startX-this.startX2),h=_(this.startY-this.startY2),a=_(this.endX-this.endX2),s=_(this.endY-this.endY2),(T(a*a+s*s)-T(e*e+h*h))/T(t*t+i*i))),this.endX2=this.startX2,this.endY2=this.startY2);break;case"crop":W.x&&W.y&&(a=this.$cropper.offset(),u=this.startX-a.left,w=this.startY-a.top,m=c.minWidth,f=c.minHeight,0<W.x?0<W.y?r="se":(r="ne",w-=f):0<W.y?(r="sw",u-=m):(r="nw",u-=m,w-=f),this.cropped||(this.cropped=d,this.$dragger.removeClass(x)))}y&&(c.width=m,c.height=f,c.left=u,c.top=w,this.directive=r,this.renderDragger()),this.startX=this.endX,this.startY=this.endY}},a.TEMPLATE=(s="div,span,directive,data,point,cropper,class,line,dashed".split(","),'<0 6="5-container"><0 6="5-canvas"></0><0 6="5-dragger"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>'.replace(/\d+/g,(function(t){return s[t]}))),a.DEFAULTS={aspectRatio:"auto",autoCropArea:.8,data:{},done:t.noop,preview:"",multiple:g,autoCrop:d,dragCrop:d,dashed:d,modal:d,movable:d,resizable:d,zoomable:d,rotatable:d,checkImageOrigin:d,minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,build:l,built:l,dragstart:l,dragmove:l,dragend:l},a.setDefaults=function(i){t.extend(a.DEFAULTS,i)},a.other=t.fn.cropper,t.fn.cropper=function(i){var h,s=e(arguments,1);return this.each((function(){var e=t(this),r=e.data("cropper");r||e.data("cropper",r=new a(this,i)),"string"==typeof i&&t.isFunction(e=r[i])&&(h=e.apply(r,s))})),typeof h!=p?h:this},t.fn.cropper.Constructor=a,t.fn.cropper.setDefaults=a.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=a.other,this}}));