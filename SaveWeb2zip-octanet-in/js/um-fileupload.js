/*!
 * jQuery Upload File Plugin
 * version: 3.1.2
 * @requires jQuery v1.5 or later & form plugin
 * Copyright (c) 2013 Ravishanker Kusuma
 * http://hayageek.com/
 */
!function(e){e.fn.ajaxForm;var r={};r.fileapi=void 0!==e("<input type='file'/>").get(0).files,r.formdata=void 0!==window.FormData,e.fn.uploadFile=function(t){var o=e.extend({url:"",method:"POST",enctype:"multipart/form-data",formData:null,returnType:null,allowedTypes:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,maxFileCount:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!0,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showProgress:!1,onSelect:function(e){return!0},onSubmit:function(e,r){},onSuccess:function(e,r,t){},onError:function(e,r,t){},deleteCallback:!1,afterUploadAll:!1,uploadButtonClass:"upload",dragDropStr:"",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"",sizeErrorStr:"",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:""},t);this.fileCounter=1,this.selectedFiles=0,this.fCounter=0,this.sCounter=0,this.tCounter=0;var a="upload-"+(new Date).getTime();this.formGroup=a,this.hide(),this.errorLog=e("<div></div>"),this.after(this.errorLog),this.responses=[],r.formdata||(o.dragDrop=!1),r.formdata||(o.multiple=!1);var s=this,i=e("<div>"+e(this).html()+"</div>");e(i).addClass(o.uploadButtonClass),function r(){if(e.fn.ajaxForm){if(o.dragDrop){var t=e('<div class="ajax-upload-dragdrop" style="vertical-align:top;"></div>');e(s).before(t),e(t).append(i),e(t).prepend(e(o.dragDropStr)),l=s,n=o,(u=t).on("dragenter",(function(r){r.stopPropagation(),r.preventDefault(),e(this).css("border","2px dashed #ddd")})),u.on("dragover",(function(e){e.stopPropagation(),e.preventDefault()})),u.on("drop",(function(r){e(this).css("border","2px dashed #ddd"),r.preventDefault(),l.errorLog.html("");var t=r.originalEvent.dataTransfer.files;!n.multiple&&t.length>1?n.showError&&e("<div class='um-error-block'>"+n.multiDragErrorStr+"</div>").appendTo(l.errorLog):0!=n.onSelect(t)&&d(n,l,t)})),e(document).on("dragenter",(function(e){e.stopPropagation(),e.preventDefault()})),e(document).on("dragover",(function(e){e.stopPropagation(),e.preventDefault(),u.css("border","2px dashed #ddd")})),e(document).on("drop",(function(e){e.stopPropagation(),e.preventDefault(),u.css("border","2px dashed #ddd")}))}else e(s).before(i);c(s,a,o,i)}else window.setTimeout(r,10);var l,n,u}(),this.startUpload=function(){e("."+this.formGroup).each((function(r,t){e(this).is("form")&&e(this).submit()}))},this.stopUpload=function(){e(".upload-red").each((function(r,t){e(this).hasClass(s.formGroup)&&e(this).click()}))},this.getResponses=function(){return this.responses};var l=!1;function n(r){var t,o,a=[],s=(a="string"==jQuery.type(r)?r.split("&"):e.param(r).split("&")).length,i=[];for(t=0;t<s;t++)a[t]=a[t].replace(/\+/g," "),o=a[t].split("="),i.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return i}function d(r,t,o){for(var a=0;a<o.length;a++)if(u(t,r,o[a].name))if(-1!=r.maxFileSize&&o[a].size>r.maxFileSize)r.showError&&e("<div class='um-error-block'>"+r.sizeErrorStr+"</div>").appendTo(t.errorLog);else if(-1!=r.maxFileCount&&t.selectedFiles>=r.maxFileCount)r.showError&&e("<div class='um-error-block'>"+r.maxFileCountErrorStr+"</div>").appendTo(t.errorLog);else{t.selectedFiles++;var s=r,i=new FormData,l=r.fileName.replace("[]","");i.append(l,o[a]);var d=r.formData;if(d)for(var p=n(d),c=0;c<p.length;c++)p[c]&&i.append(p[c][0],p[c][1]);s.fileData=i;var m=new h(t,r);r.showFileCounter?t.fileCounter+r.fileCounterStyle+o[a].name:o[a].name;var v=e("<form style='display:block; position:absolute;left: 150px;' class='"+t.formGroup+"' method='"+r.method+"' action='"+r.url+"' enctype='"+r.enctype+"'></form>");v.appendTo("body");var g=[];g.push(o[a].name),f(v,s,m,g,t),t.fileCounter++}else r.showError&&e("<div class='um-error-block'>"+r.extErrorStr+"</div>").appendTo(t.errorLog)}function u(e,r,t){var o=r.allowedTypes.toLowerCase().split(","),a=t.split(".").pop().toLowerCase();return!("*"!=r.allowedTypes&&jQuery.inArray(a,o)<0)}function p(r,t){if(r.showFileCounter){var o=e(".upload-filename").length;t.fileCounter=o+1,e(".upload-filename").each((function(t,a){var s=e(this).html().split(r.fileCounterStyle),i=(parseInt(s[0]),o+r.fileCounterStyle+s[1]);e(this).html(i),o--}))}}function c(t,o,a,s){var i="ajax-upload-id-"+(new Date).getTime(),l=e("<form method='"+a.method+"' action='"+a.url+"' enctype='"+a.enctype+"'></form>"),n="<input type='file' id='"+i+"' name='"+a.fileName+"'/>";a.multiple&&(a.fileName.indexOf("[]")!=a.fileName.length-2&&(a.fileName+="[]"),n="<input type='file' id='"+i+"' name='"+a.fileName+"' multiple/>");var m=e(n).appendTo(l);m.change((function(){t.errorLog.html("");a.allowedTypes.toLowerCase().split(",");var i=[];if(this.files){for(b=0;b<this.files.length;b++)i.push(this.files[b].name);if(0==a.onSelect(this.files))return}else{var n=e(this).val(),m=[];if(i.push(n),!u(0,a,n))return void(a.showError&&e("<div class='um-error-block'>"+a.extErrorStr+"</div>").appendTo(t.errorLog));if(m.push({name:n,size:"NA"}),0==a.onSelect(m))return}if(p(a,t),s.unbind("click"),l.hide(),c(t,o,a,s),l.addClass(o),r.fileapi&&r.formdata){l.removeClass(o);var v=this.files;d(a,t,v)}else{for(var g="",b=0;b<i.length;b++)a.showFileCounter?g+=t.fileCounter+a.fileCounterStyle+i[b]+"<br>":g+=i[b]+"<br>",t.fileCounter++;if(-1!=a.maxFileCount&&t.selectedFiles+i.length>a.maxFileCount)return void(a.showError&&e("<div class='um-error-block'>"+a.maxFileCountErrorStr+"</div>").appendTo(t.errorLog));t.selectedFiles+=i.length;var w=new h(t,a);w.filename.html(g),f(l,a,w,i,t)}})),l.css({margin:0,padding:0});var v=e(s).width()+10;10==v&&(v=120);var g=s.height()+10;10==g&&(g=35),s.css({position:"relative",overflow:"hidden",cursor:"default"}),m.css({position:"absolute",cursor:"pointer",top:"0px",width:"100%",height:"34px",left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),l.appendTo(s)}function h(r,t){return this.statusbar=e("<div class='upload-statusbar'></div>"),this.progressDiv=e("<div class='upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=e("<div class='upload-bar "+r.formGroup+"'></div>").appendTo(this.progressDiv),this.abort=e("<div class='upload-red "+r.formGroup+"'>"+t.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=e("<div class='upload-red'>"+t.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=e("<div class='upload-green'>"+t.doneStr+"</div>").appendTo(this.statusbar).hide(),this.del=e("<div class='upload-red'>"+t.deletelStr+"</div>").appendTo(this.statusbar).hide(),r.errorLog.after(this.statusbar),this}function f(e,t,a,i,d){var u={cache:!1,contentType:!1,processData:!1,forceSync:!1,data:t.formData,formData:t.fileData,dataType:t.returnType,beforeSubmit:function(r,u,p){if(0!=t.onSubmit.call(this,i)){var c=t.dynamicFormData();if(c){var h=n(c);if(h)for(var f=0;f<h.length;f++)h[f]&&(null!=t.fileData?p.formData.append(h[f][0],h[f][1]):p.data[h[f][0]]=h[f][1])}return d.tCounter+=i.length,o.afterUploadAll&&!l&&(l=!0,function e(){0!=s.sCounter&&s.sCounter+s.fCounter==s.tCounter?(o.afterUploadAll(s),l=!1):window.setTimeout(e,100)}()),!0}return a.statusbar.append("<div class='um-error-block'>"+t.uploadErrorStr+"</div>"),a.cancel.show(),e.remove(),a.cancel.click((function(){a.statusbar.remove()})),!1},beforeSend:function(e,o){a.progressDiv.show(),a.cancel.hide(),a.done.hide(),t.showAbort&&(a.abort.show(),a.abort.click((function(){e.abort(),d.selectedFiles-=i.length}))),r.formdata?a.progressbar.width("1%"):a.progressbar.width("5%")},uploadProgress:function(e,r,o,s){s>98&&(s=98);var i=s+"%";s>1&&a.progressbar.width(i),t.showProgress&&(a.progressbar.html(i),a.progressbar.css("text-align","center"))},success:function(r,o,s){d.responses.push(r),a.progressbar.width("100%"),t.showProgress&&(a.progressbar.html("100%"),a.progressbar.css("text-align","center")),a.abort.hide(),t.onSuccess.call(this,i,r,s),t.showStatusAfterSuccess?(t.showDone?(a.done.show(),a.done.click((function(){a.statusbar.hide("slow"),a.statusbar.remove()}))):a.done.hide(),t.showDelete?(a.del.show(),a.del.click((function(){a.statusbar.hide().remove(),t.deleteCallback&&t.deleteCallback.call(this,r,a),d.selectedFiles-=i.length,p(t,d)}))):a.del.hide()):(a.statusbar.hide("slow"),a.statusbar.remove()),e.remove(),d.sCounter+=i.length},error:function(r,o,s){a.abort.hide(),"abort"==r.statusText?(a.statusbar.hide("slow").remove(),p(t,d)):(t.onError.call(this,i,o,s),t.showStatusAfterError?(a.progressDiv.hide(),a.statusbar.append("<span class='um-error-block'>ERROR: "+s+"</span>")):(a.statusbar.hide(),a.statusbar.remove()),d.selectedFiles-=i.length),e.remove(),d.fCounter+=i.length}};t.autoSubmit?e.ajaxSubmit(u):(t.showCancel&&(a.cancel.show(),a.cancel.click((function(){e.remove(),a.statusbar.remove(),d.selectedFiles-=i.length,p(t,d)}))),e.ajaxForm(u))}return this}}(jQuery);